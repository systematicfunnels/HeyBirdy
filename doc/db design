Below is a **clean, scalable, implementation-ready Database Design** for **HeyBirdy**, aligned with everything we locked:

* one user identity
* progressive capability activation
* content-centric system
* affiliate + rewards + community
* event-driven growth

This is written so **backend engineers can start schema creation immediately** and **scale later without rewrites**.

---

# ðŸ—„ï¸ Database Design â€” HeyBirdy

> **Database Principle**
> Store **facts**, not assumptions.
> Roles are derived from **capabilities + events**, not hard-coded types.

---

## 1ï¸âƒ£ Database Strategy

### Primary Database

* **PostgreSQL** (source of truth)

### Supporting Stores

* **Redis** â†’ caching, counters, sessions
* **Object Storage (S3 / Cloudinary)** â†’ media
* **Event Store (Kafka / Redis Streams)** â†’ async processing

---

## 2ï¸âƒ£ Core Identity Model (FOUNDATION)

### 2.1 Users (Single Identity)

```sql
users
-----
id (PK)
email (unique)
username (unique)
created_at
updated_at
```

ðŸ“Œ One user = one identity
ðŸ“Œ No role column here

---

### 2.2 Profiles (Human Layer)

```sql
profiles
--------
user_id (PK, FK â†’ users.id)
display_name
bio
avatar_url
created_at
updated_at
```

Used by:

* creators
* affiliates
* members

---

## 3ï¸âƒ£ Capability System (CRITICAL)

### 3.1 Capabilities

```sql
capabilities
------------
user_id (PK, FK â†’ users.id)
is_member BOOLEAN DEFAULT true
is_affiliate BOOLEAN DEFAULT false
is_creator BOOLEAN DEFAULT false
affiliate_activated_at
creator_activated_at
```

ðŸ“Œ Capabilities are toggled by **actions**
ðŸ“Œ Never manually assigned by role selection

---

## 4ï¸âƒ£ Content System (Core Product)

### 4.1 Content

```sql
content
-------
id (PK)
creator_id (FK â†’ users.id)
type ENUM ('video','article','course')
title
description
price
currency
affiliate_enabled BOOLEAN
status ENUM ('draft','published','archived')
created_at
updated_at
```

---

### 4.2 Content Media

```sql
content_media
-------------
id (PK)
content_id (FK â†’ content.id)
media_type ENUM ('video','image','file')
media_url
duration
```

---

### 4.3 Content Access (Purchases)

```sql
content_access
--------------
id (PK)
user_id (FK â†’ users.id)
content_id (FK â†’ content.id)
purchase_id
granted_at
```

---

## 5ï¸âƒ£ Affiliate System (Growth Engine)

### 5.1 Affiliate Programs

```sql
affiliate_programs
------------------
id (PK)
content_id (FK â†’ content.id)
creator_id (FK â†’ users.id)
commission_percentage
is_active
created_at
```

---

### 5.2 Affiliate Links

```sql
affiliate_links
---------------
id (PK)
affiliate_id (FK â†’ users.id)
content_id (FK â†’ content.id)
code (unique)
created_at
```

---

### 5.3 Affiliate Clicks

```sql
affiliate_clicks
----------------
id (PK)
affiliate_link_id (FK â†’ affiliate_links.id)
ip_address
user_agent
clicked_at
```

(Hot data â†’ cache in Redis)

---

### 5.4 Affiliate Conversions

```sql
affiliate_conversions
---------------------
id (PK)
affiliate_link_id (FK)
buyer_id (FK â†’ users.id)
purchase_id
converted_at
```

---

### 5.5 Affiliate Earnings

```sql
affiliate_earnings
------------------
id (PK)
affiliate_id (FK â†’ users.id)
content_id (FK)
amount
currency
status ENUM ('pending','approved','paid')
created_at
```

---

## 6ï¸âƒ£ Payments & Monetization

### 6.1 Purchases

```sql
purchases
---------
id (PK)
buyer_id (FK â†’ users.id)
content_id (FK)
total_amount
currency
payment_provider
payment_status
created_at
```

---

### 6.2 Payouts

```sql
payouts
-------
id (PK)
user_id (FK â†’ users.id)
amount
currency
status ENUM ('pending','processing','completed')
scheduled_at
processed_at
```

---

## 7ï¸âƒ£ Rewards & Gamification

### 7.1 Points Ledger (Immutable)

```sql
points_ledger
-------------
id (PK)
user_id (FK â†’ users.id)
points
reason
event_id
created_at
```

ðŸ“Œ Never update points directly
ðŸ“Œ Always append (audit-safe)

---

### 7.2 Badges

```sql
badges
------
id (PK)
name
description
icon
```

---

### 7.3 User Badges

```sql
user_badges
-----------
user_id (FK â†’ users.id)
badge_id (FK â†’ badges.id)
earned_at
```

---

## 8ï¸âƒ£ Community & Social Layer

### 8.1 Comments

```sql
comments
--------
id (PK)
user_id (FK â†’ users.id)
content_id (FK â†’ content.id)
parent_id (nullable)
body
created_at
```

---

### 8.2 Follows

```sql
follows
-------
follower_id (FK â†’ users.id)
followed_id (FK â†’ users.id)
created_at
```

---

## 9ï¸âƒ£ Notifications

### 9.1 Notifications

```sql
notifications
-------------
id (PK)
user_id (FK â†’ users.id)
type
payload JSONB
is_read BOOLEAN
created_at
```

---

## ðŸ” 10ï¸âƒ£ Event Store (ASYNC CORE)

### 10.1 Events

```sql
events
------
id (PK)
event_type
user_id
metadata JSONB
created_at
```

Used by:

* rewards
* analytics
* notifications
* fraud detection

---

## 11ï¸âƒ£ Analytics (Derived, Not Primary)

Analytics tables are **derived** from events.

Example:

```sql
daily_user_activity
affiliate_performance
creator_revenue_summary
```

Never block user actions on analytics writes.

---

## 12ï¸âƒ£ Indexing & Performance Rules

* Index all FK columns
* Index `affiliate_links.code`
* Index `content.creator_id`
* Partial indexes for:

  * `affiliate_earnings.status = 'pending'`
  * `notifications.is_read = false`

---

## 13ï¸âƒ£ Data Integrity Rules (NON-NEGOTIABLE)

1. Never delete earnings records
2. Never mutate points ledger
3. Never store role as ENUM
4. Capabilities change only via events
5. Payments are append-only

---

## ðŸ§  Final Database Summary

> **HeyBirdyâ€™s database is built around actions,
> not labels â€”
> facts, not guesses â€”
> and growth, not static roles.**

This schema:

* supports progressive roles
* scales to millions of users
* keeps financial data safe
* enables real-time rewards

---

### ðŸ”œ Next (Strongly Recommended)

I can:

* Generate **ER diagram**
* Create **migration scripts**
* Define **Redis schema**
* Design **event contracts**
* Estimate **DB cost at scale**

Tell me what you want next ðŸ‘Œ
